
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Draw entity relationship diagrams for Pydantic models and standard library dataclasses.">
      
      
      
        <link rel="canonical" href="https://erdantic.drivendata.org/stable/extending/">
      
      
        <link rel="prev" href="../customizing/">
      
      
        <link rel="next" href="../forward-references/">
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.15">
    
    
      
        <title>Extending or Modifying - erdantic</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.342714a4.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../assets/_mkdocstrings.css">
    
      <link rel="stylesheet" href="../css/mkdocs-jupyter-extra.css">
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    <body dir="ltr">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#extending-or-modifying-erdantic" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <div data-md-color-scheme="default" data-md-component="outdated" hidden>
        
      </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="erdantic" class="md-header__button md-logo" aria-label="erdantic" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            erdantic
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Extending or Modifying
            
          </span>
        </div>
      </div>
    </div>
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/drivendataorg/erdantic" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="erdantic" class="md-nav__button md-logo" aria-label="erdantic" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    erdantic
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/drivendataorg/erdantic" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Home
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../cli/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    CLI Help
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../changelog/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Changelog
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
        
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    Usage Examples
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            Usage Examples
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../examples/attrs.ipynb" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Usage Example: attrs
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../examples/dataclasses.ipynb" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Usage Example: dataclasses
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../examples/msgspec.ipynb" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Usage Example: msgspec
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../examples/pydantic.ipynb" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Usage Example: Pydantic
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
      
        
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" checked>
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    Advanced Usage
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            Advanced Usage
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../output-formats/d2.ipynb" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    D2 Output
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../customizing/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Customizing Diagrams
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    Extending or Modifying
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    Extending or Modifying
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#plugins-for-model-frameworks" class="md-nav__link">
    <span class="md-ellipsis">
      Plugins for model frameworks
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Plugins for model frameworks">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#components-of-a-plugin" class="md-nav__link">
    <span class="md-ellipsis">
      Components of a plugin
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#registering-a-plugin" class="md-nav__link">
    <span class="md-ellipsis">
      Registering a plugin
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#erdantic.plugins.register_plugin" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;register_plugin
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#modifying-model-analysis-or-diagram-rendering" class="md-nav__link">
    <span class="md-ellipsis">
      Modifying model analysis or diagram rendering
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Modifying model analysis or diagram rendering">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#what-to-change" class="md-nav__link">
    <span class="md-ellipsis">
      What to change
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#get-erdantic-to-use-your-subclasses" class="md-nav__link">
    <span class="md-ellipsis">
      Get erdantic to use your subclasses
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#example-adding-a-column-with-default-field-values" class="md-nav__link">
    <span class="md-ellipsis">
      Example: Adding a column with default field values
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../forward-references/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Handling Forward References
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
        
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6" >
        
          
          <label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    API Reference
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6">
            <span class="md-nav__icon md-icon"></span>
            API Reference
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../api-reference/convenience/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    erdantic.convenience
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../api-reference/core/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    erdantic.core
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../api-reference/d2/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    erdantic.d2
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../api-reference/exceptions/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    erdantic.exceptions
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6_5" >
        
          
          <label class="md-nav__link" for="__nav_6_5" id="__nav_6_5_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    erdantic.examples
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_6_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6_5">
            <span class="md-nav__icon md-icon"></span>
            erdantic.examples
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../api-reference/examples/attrs/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    erdantic.examples.attrs
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../api-reference/examples/dataclasses/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    erdantic.examples.dataclasses
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../api-reference/examples/msgspec/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    erdantic.examples.msgspec
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../api-reference/examples/pydantic/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    erdantic.examples.pydantic
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../api-reference/examples/pydantic_v1/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    erdantic.examples.pydantic_v1
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6_6" >
        
          
          <label class="md-nav__link" for="__nav_6_6" id="__nav_6_6_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    erdantic.plugins
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_6_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6_6">
            <span class="md-nav__icon md-icon"></span>
            erdantic.plugins
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../api-reference/plugins/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    erdantic.plugins
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../api-reference/plugins/attrs/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    erdantic.plugins.attrs
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../api-reference/plugins/dataclasses/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    erdantic.plugins.dataclasses
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../api-reference/plugins/msgspec/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    erdantic.plugins.msgspec
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../api-reference/plugins/pydantic/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    erdantic.plugins.pydantic
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../api-reference/typing_utils/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    erdantic.typing_utils
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#plugins-for-model-frameworks" class="md-nav__link">
    <span class="md-ellipsis">
      Plugins for model frameworks
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Plugins for model frameworks">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#components-of-a-plugin" class="md-nav__link">
    <span class="md-ellipsis">
      Components of a plugin
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#registering-a-plugin" class="md-nav__link">
    <span class="md-ellipsis">
      Registering a plugin
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#erdantic.plugins.register_plugin" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;register_plugin
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#modifying-model-analysis-or-diagram-rendering" class="md-nav__link">
    <span class="md-ellipsis">
      Modifying model analysis or diagram rendering
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Modifying model analysis or diagram rendering">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#what-to-change" class="md-nav__link">
    <span class="md-ellipsis">
      What to change
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#get-erdantic-to-use-your-subclasses" class="md-nav__link">
    <span class="md-ellipsis">
      Get erdantic to use your subclasses
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#example-adding-a-column-with-default-field-values" class="md-nav__link">
    <span class="md-ellipsis">
      Example: Adding a column with default field values
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


  
  


<h1 id="extending-or-modifying-erdantic">Extending or modifying erdantic<a class="headerlink" href="#extending-or-modifying-erdantic" title="Permanent link">&para;</a></h1>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The backend of erdantic was significantly updated in v1.0. This now works very differently than previous versions.</p>
</div>
<h2 id="plugins-for-model-frameworks">Plugins for model frameworks<a class="headerlink" href="#plugins-for-model-frameworks" title="Permanent link">&para;</a></h2>
<p>erdantic supports data modeling frameworks through a <strong>plugins</strong> system. Each plugin must implement specific functionality and get registered for erdantic to use it.</p>
<p>The following built-in plugins are provided by erdantic:</p>
<ol>
<li><code>attrs</code> — for classes decorated using the <a href="https://www.attrs.org/en/stable/index.html">attrs</a> package</li>
<li><code>dataclasses</code> — for classes decorated using the <a href="https://docs.python.org/3/library/dataclasses.html">dataclasses</a> standard library module</li>
<li><code>pydantic</code> — for classes that subclass Pydantic's <code>BaseModel</code> class</li>
<li><code>pydantic_v1</code> — for classes that subclass Pydantic's legacy <code>pydantic.v1.BaseModel</code> class</li>
</ol>
<p>It is possible to customize erdantic by registering a custom plugin, either by overriding a provided one or adding as a new one. The following sections document what you need to register your own plugin.</p>
<h3 id="components-of-a-plugin">Components of a plugin<a class="headerlink" href="#components-of-a-plugin" title="Permanent link">&para;</a></h3>
<p>A plugin must implement the following two components: a predicate function and a field extractor function.</p>
<h4 id="predicate-function">Predicate function<a class="headerlink" href="#predicate-function" title="Permanent link">&para;</a></h4>
<p>A <strong>predicate function</strong> takes a single object as an input and return a boolean value <code>True</code> if the object is a data model class that this plugin is for and <code>False</code> otherwise. The return type of this function is a <a href="https://typing.readthedocs.io/en/latest/spec/narrowing.html"><code>TypeGuard</code></a> for the model class. A <a href="https://typing.readthedocs.io/en/latest/spec/protocol.html">protocol</a> class <a class="autorefs autorefs-internal" title="            ModelPredicate" href="../api-reference/plugins/#erdantic.plugins.ModelPredicate"><code>ModelPredicate</code></a> defines the specification for a valid predicate function.</p>
<div class="admonition info">
<p class="admonition-title">Source from <code>erdantic/plugins/__init__.py</code></p>
<div class="highlight"><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">ModelPredicate</span><span class="p">(</span><span class="n">Protocol</span><span class="p">[</span><span class="n">_ModelType_co</span><span class="p">]):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Protocol class for a predicate function for a plugin.&quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">TypeGuard</span><span class="p">[</span><span class="n">_ModelType_co</span><span class="p">]:</span> <span class="o">...</span>
</code></pre></div>
</div>
<p>Example implementations of predicate functions include <a class="autorefs autorefs-internal" title="            is_pydantic_model" href="../api-reference/plugins/pydantic/#erdantic.plugins.pydantic.is_pydantic_model"><code>is_pydantic_model</code></a> and <a class="autorefs autorefs-internal" title="            is_dataclass_class" href="../api-reference/plugins/dataclasses/#erdantic.plugins.dataclasses.is_dataclass_class"><code>is_dataclass_class</code></a>.</p>
<h4 id="field-extractor-function">Field extractor function<a class="headerlink" href="#field-extractor-function" title="Permanent link">&para;</a></h4>
<p>A <strong>field extractor function</strong> takes a single model class of the appropriate type and returns a sequence of <a class="autorefs autorefs-internal" title="            FieldInfo" href="../api-reference/core/#erdantic.core.FieldInfo"><code>FieldInfo</code></a> instances. A <a href="https://typing.readthedocs.io/en/latest/spec/protocol.html">protocol</a> class <a class="autorefs autorefs-internal" title="            ModelFieldExtractor" href="../api-reference/plugins/#erdantic.plugins.ModelFieldExtractor"><code>ModelFieldExtractor</code></a> defines the specification for a valid field extractor function.</p>
<div class="admonition info">
<p class="admonition-title">Source from <code>erdantic/plugins/__init__.py</code></p>
<div class="highlight"><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">ModelFieldExtractor</span><span class="p">(</span><span class="n">Protocol</span><span class="p">[</span><span class="n">_ModelType_contra</span><span class="p">]):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Protocol class for a field extractor function for a plugin.&quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model</span><span class="p">:</span> <span class="n">_ModelType_contra</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Sequence</span><span class="p">[</span><span class="s2">&quot;FieldInfo&quot;</span><span class="p">]:</span> <span class="o">...</span>
</code></pre></div>
</div>
<p>Example implementations of field extractor functions include <a class="autorefs autorefs-internal" title="            get_fields_from_pydantic_model" href="../api-reference/plugins/pydantic/#erdantic.plugins.pydantic.get_fields_from_pydantic_model"><code>get_fields_from_pydantic_model</code></a> and <a class="autorefs autorefs-internal" title="            get_fields_from_dataclass" href="../api-reference/plugins/dataclasses/#erdantic.plugins.dataclasses.get_fields_from_dataclass"><code>get_fields_from_dataclass</code></a>.</p>
<p>The field extractor function is the place where you should try to resolve forward references. Some frameworks provide utility functions to resolve forward references, like Pydantic's <a class="autorefs autorefs-external" href="https://docs.pydantic.dev/latest/api/base_model/#pydantic.BaseModel.model_rebuild"><code>model_rebuild</code></a> and attr's <a class="autorefs autorefs-external" href="https://www.attrs.org/en/stable/api.html#attrs.resolve_types"><code>resolve_types</code></a>. If there isn't one, you should write your own using erdantic's <a class="autorefs autorefs-internal" title="            resolve_types_on_dataclass" href="../api-reference/plugins/dataclasses/#erdantic.plugins.dataclasses.resolve_types_on_dataclass"><code>resolve_types_on_dataclass</code></a> as a reference implementation.</p>
<h3 id="registering-a-plugin">Registering a plugin<a class="headerlink" href="#registering-a-plugin" title="Permanent link">&para;</a></h3>
<p>A plugin must be registered by calling the <a class="autorefs autorefs-internal" title="            register_plugin" href="#erdantic.plugins.register_plugin"><code>register_plugin</code></a> function with a key identifier and the two functions. If you use a key that already exists, it will overwrite the existing plugin.</p>
<div class="admonition info">
<p class="admonition-title">Info</p>


<div class="doc doc-object doc-function">


<h3 id="erdantic.plugins.register_plugin" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-function"></code>            <span class="doc doc-object-name doc-function-name">register_plugin</span>


<a href="#erdantic.plugins.register_plugin" class="headerlink" title="Permanent link">&para;</a></h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">register_plugin</span><span class="p">(</span>
    <span class="n">key</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#str">str</a></span><span class="p">,</span>
    <span class="n">predicate_fn</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-internal" title="            ModelPredicate (erdantic.plugins.ModelPredicate)" href="../api-reference/plugins/#erdantic.plugins.ModelPredicate">ModelPredicate</a></span><span class="p">[</span><span class="n"><span title="erdantic.plugins._ModelType">_ModelType</span></span><span class="p">],</span>
    <span class="n">get_fields_fn</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-internal" title="            ModelFieldExtractor (erdantic.plugins.ModelFieldExtractor)" href="../api-reference/plugins/#erdantic.plugins.ModelFieldExtractor">ModelFieldExtractor</a></span><span class="p">[</span><span class="n"><span title="erdantic.plugins._ModelType">_ModelType</span></span><span class="p">],</span>
<span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents first">

        <p>Register a plugin for a specific model class type.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>key</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#str">str</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>An identifier for this plugin.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>predicate_fn</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="            ModelPredicate (erdantic.plugins.ModelPredicate)" href="../api-reference/plugins/#erdantic.plugins.ModelPredicate">ModelPredicate</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A predicate function to determine if an object is a class
of the model that is supported by this plugin.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>get_fields_fn</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="            ModelFieldExtractor (erdantic.plugins.ModelFieldExtractor)" href="../api-reference/plugins/#erdantic.plugins.ModelFieldExtractor">ModelFieldExtractor</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A function to extract fields from a model class that
is supported by this plugin.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    </div>

</div></div>
<p>Currently, manual registration is required. This means that custom plugins can only be loaded when using erdantic as a library, and not as a CLI. In the future, we may support automatic loading of plugins that are distributed with packages through the <a href="https://packaging.python.org/en/latest/specifications/entry-points/">entry points specification</a>.</p>
<h2 id="modifying-model-analysis-or-diagram-rendering">Modifying model analysis or diagram rendering<a class="headerlink" href="#modifying-model-analysis-or-diagram-rendering" title="Permanent link">&para;</a></h2>
<p>If you would like to make any major changes to the functionality of erdantic, such as:</p>
<ul>
<li>Changing what data gets extracted when analyzing a model</li>
<li>Structural changes to how models are represented in the diagram</li>
</ul>
<p>then you can subclass <a class="autorefs autorefs-internal" title="            EntityRelationshipDiagram" href="../api-reference/core/#erdantic.core.EntityRelationshipDiagram"><code>EntityRelationshipDiagram</code></a>, <a class="autorefs autorefs-internal" title="            ModelInfo" href="../api-reference/core/#erdantic.core.ModelInfo"><code>ModelInfo</code></a>, <a class="autorefs autorefs-internal" title="            FieldInfo" href="../api-reference/core/#erdantic.core.FieldInfo"><code>FieldInfo</code></a>, and/or <a class="autorefs autorefs-internal" title="            Edge" href="../api-reference/core/#erdantic.core.Edge"><code>Edge</code></a> to modify any behavior.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Changes like these depend on the internal APIs of erdantic and may be more likely to break between erdantic versions. If you're trying to do something like this, it would be nice to let the maintainers know in the <a href="https://github.com/drivendataorg/erdantic/discussions">repository discussions</a>.</p>
</div>
<h3 id="what-to-change">What to change<a class="headerlink" href="#what-to-change" title="Permanent link">&para;</a></h3>
<p>Here are some tips on what to change depending on your goals:</p>
<ul>
<li>To change the model-level data that is extracted and stored when analyzing a model...<ul>
<li>Override <a class="autorefs autorefs-internal" title="            from_raw_model


  
      classmethod
  " href="../api-reference/core/#erdantic.core.ModelInfo.from_raw_model"><code>ModelInfo.from_raw_model</code></a></li>
</ul>
</li>
<li>To change the field-level data that is extracted and stored when analyzing a model...<ul>
<li>Add or override a plugin's <a href="#field-extractor-function">field extractor function</a> and/or override <a class="autorefs autorefs-internal" title="            from_raw_type


  
      classmethod
  " href="../api-reference/core/#erdantic.core.FieldInfo.from_raw_type"><code>FieldInfo.from_raw_type</code></a></li>
</ul>
</li>
<li>To change the structure of the model tables in the diagram...<ul>
<li>Override <a class="autorefs autorefs-internal" title="            to_dot_row" href="../api-reference/core/#erdantic.core.FieldInfo.to_dot_row"><code>FieldInfo.to_dot_row</code></a> to change the DOT code for each field's row</li>
<li>Override <a class="autorefs autorefs-internal" title="            to_dot_label" href="../api-reference/core/#erdantic.core.ModelInfo.to_dot_label"><code>ModelInfo.to_dot_label</code></a> to change the table DOT code</li>
</ul>
</li>
</ul>
<h3 id="get-erdantic-to-use-your-subclasses">Get erdantic to use your subclasses<a class="headerlink" href="#get-erdantic-to-use-your-subclasses" title="Permanent link">&para;</a></h3>
<p>The best way to use custom subclasses is to subclass <code>EntityRelationshipDiagram</code>. Then, you can instantiate an instance of it and call its methods.</p>
<div class="admonition example">
<p class="admonition-title">Example</p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">erdantic.core</span><span class="w"> </span><span class="kn">import</span> <span class="n">EntityRelationshipDiagram</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">erdantic.examples.pydantic</span><span class="w"> </span><span class="kn">import</span> <span class="n">Party</span>

<span class="k">class</span><span class="w"> </span><span class="nc">CustomEntityRelationshipDiagram</span><span class="p">(</span><span class="n">EntityRelationshipDiagram</span><span class="p">):</span>
    <span class="o">...</span>

<span class="n">diagram</span> <span class="o">=</span> <span class="n">CustomEntityRelationshipDiagram</span><span class="p">()</span>
<span class="n">diagram</span><span class="o">.</span><span class="n">add_model</span><span class="p">(</span><span class="n">Party</span><span class="p">)</span>
<span class="n">diagram</span><span class="o">.</span><span class="n">draw</span><span class="p">(</span><span class="s2">&quot;diagram.png&quot;</span><span class="p">)</span>
</code></pre></div>
</div>
<p>Then, depending on which classes you're implementing subclasses of, you will want to do the following:</p>
<ul>
<li>If subclassing <code>ModelInfo</code>...<ul>
<li>Also subclass <code>EntityRelationshipDiagram</code> and override the type annotation for <code>models</code> to use your custom subclass. The model info class used is determined by this type annotation.</li>
</ul>
</li>
<li>If subclassing <code>FieldInfo</code>...<ul>
<li>Also subclass <code>ModelInfo</code> and override the the type annotation for <code>fields</code> to use your custom subclass.</li>
<li>Add or override a plugin's <a href="#field-extractor-function">field extractor function</a>. The field info instances are instantiated in the field extractor function.</li>
</ul>
</li>
<li>If subclassing <code>Edge</code>...<ul>
<li>Also subclass <code>EntityRelationshipDiagram</code> and override the type annotation for <code>edges</code> to use your custom subclass. The edge class used is determined by this type annotation.</li>
</ul>
</li>
</ul>
<h3 id="example-adding-a-column-with-default-field-values">Example: Adding a column with default field values<a class="headerlink" href="#example-adding-a-column-with-default-field-values" title="Permanent link">&para;</a></h3>
<p>Below is an example that has modified handling of Pydantic models. It extracts and stores the default value for fields, and it adds them as a third column to the tables in the diagram.</p>
<p>Here is how the rendered diagram looks:</p>
<p><img alt="Diagram with erdantic modified to add a third column" src="../assets/pydantic_with_default_column_diagram.png" /></p>
<p>And here is the source code:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">  1</span>
<span class="normal">  2</span>
<span class="normal">  3</span>
<span class="normal">  4</span>
<span class="normal">  5</span>
<span class="normal">  6</span>
<span class="normal">  7</span>
<span class="normal">  8</span>
<span class="normal">  9</span>
<span class="normal"> 10</span>
<span class="normal"> 11</span>
<span class="normal"> 12</span>
<span class="normal"> 13</span>
<span class="normal"> 14</span>
<span class="normal"> 15</span>
<span class="normal"> 16</span>
<span class="normal"> 17</span>
<span class="normal"> 18</span>
<span class="normal"> 19</span>
<span class="normal"> 20</span>
<span class="normal"> 21</span>
<span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">html</span><span class="w"> </span><span class="kn">import</span> <span class="n">escape</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">Any</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">pydantic</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pydantic_core</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">typenames</span><span class="w"> </span><span class="kn">import</span> <span class="n">REMOVE_ALL_MODULES</span><span class="p">,</span> <span class="n">typenames</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">erdantic.core</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
    <span class="n">EntityRelationshipDiagram</span><span class="p">,</span>
    <span class="n">FieldInfo</span><span class="p">,</span>
    <span class="n">FullyQualifiedName</span><span class="p">,</span>
    <span class="n">ModelInfo</span><span class="p">,</span>
    <span class="n">SortedDict</span><span class="p">,</span>
<span class="p">)</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">erdantic.exceptions</span><span class="w"> </span><span class="kn">import</span> <span class="n">UnresolvableForwardRefError</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">erdantic.plugins</span><span class="w"> </span><span class="kn">import</span> <span class="n">register_plugin</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">erdantic.plugins.pydantic</span><span class="w"> </span><span class="kn">import</span> <span class="n">is_pydantic_model</span>


<span class="k">class</span><span class="w"> </span><span class="nc">FieldInfoWithDefault</span><span class="p">(</span><span class="n">FieldInfo</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Custom FieldInfo subclass that adds a &#39;default_value&#39; field and diagram column.&quot;&quot;&quot;</span>

    <span class="n">default_value</span><span class="p">:</span> <span class="nb">str</span>

    <span class="n">_dot_row_template</span> <span class="o">=</span> <span class="p">(</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;&lt;tr&gt;&quot;&quot;&quot;</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;&lt;td&gt;{name}&lt;/td&gt;&quot;&quot;&quot;</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;&lt;td&gt;{type_name}&lt;/td&gt;&quot;&quot;&quot;</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;&lt;td port=&quot;{name}&quot; width=&quot;36&quot;&gt;{default_value}&lt;/td&gt;&quot;&quot;&quot;</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;&lt;/tr&gt;&quot;&quot;&quot;</span>
    <span class="p">)</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">from_raw_type</span><span class="p">(</span>
        <span class="bp">cls</span><span class="p">,</span> <span class="n">model_full_name</span><span class="p">:</span> <span class="n">FullyQualifiedName</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">raw_type</span><span class="p">:</span> <span class="nb">type</span><span class="p">,</span> <span class="n">raw_default_value</span><span class="p">:</span> <span class="n">Any</span>
    <span class="p">):</span>
        <span class="n">default_value</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s2">&quot;&quot;</span> <span class="k">if</span> <span class="n">raw_default_value</span> <span class="ow">is</span> <span class="n">pydantic_core</span><span class="o">.</span><span class="n">PydanticUndefined</span> <span class="k">else</span> <span class="nb">repr</span><span class="p">(</span><span class="n">raw_default_value</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="n">field_info</span> <span class="o">=</span> <span class="bp">cls</span><span class="p">(</span>
            <span class="n">model_full_name</span><span class="o">=</span><span class="n">model_full_name</span><span class="p">,</span>
            <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span>
            <span class="n">type_name</span><span class="o">=</span><span class="n">typenames</span><span class="p">(</span><span class="n">raw_type</span><span class="p">,</span> <span class="n">remove_modules</span><span class="o">=</span><span class="n">REMOVE_ALL_MODULES</span><span class="p">),</span>
            <span class="n">default_value</span><span class="o">=</span><span class="n">default_value</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">field_info</span><span class="o">.</span><span class="n">_raw_type</span> <span class="o">=</span> <span class="n">raw_type</span>
        <span class="k">return</span> <span class="n">field_info</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">to_dot_row</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dot_row_template</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="n">name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
            <span class="n">type_name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">type_name</span><span class="p">,</span>
            <span class="n">default_value</span><span class="o">=</span><span class="n">escape</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">default_value</span><span class="p">),</span>  <span class="c1"># Escape HTML-unsafe characters</span>
        <span class="p">)</span>


<span class="k">class</span><span class="w"> </span><span class="nc">ModelInfoWithDefault</span><span class="p">(</span><span class="n">ModelInfo</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Custom ModelInfo subclass that uses FieldInfoWithDefault instead of FieldInfo.&quot;&quot;&quot;</span>

    <span class="n">fields</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">FieldInfoWithDefault</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>


<span class="k">class</span><span class="w"> </span><span class="nc">EntityRelationshipDiagramWithDefault</span><span class="p">(</span><span class="n">EntityRelationshipDiagram</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Custom EntityRelationshipDiagram subclass that uses ModelInfoWithDefault instead of</span>
<span class="sd">    ModelInfo.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">models</span><span class="p">:</span> <span class="n">SortedDict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">ModelInfoWithDefault</span><span class="p">]</span> <span class="o">=</span> <span class="n">SortedDict</span><span class="p">()</span>


<span class="k">def</span><span class="w"> </span><span class="nf">get_fields_from_pydantic_model_with_default</span><span class="p">(</span><span class="n">model</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">FieldInfoWithDefault</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Copied from erdantic.plugins.pydantic.get_fields_from_pydantic_model and modified to</span>
<span class="sd">    extract default values of fields.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># Rebuild model schema to resolve forward references</span>
        <span class="n">model</span><span class="o">.</span><span class="n">model_rebuild</span><span class="p">()</span>
    <span class="k">except</span> <span class="n">pydantic</span><span class="o">.</span><span class="n">errors</span><span class="o">.</span><span class="n">PydanticUndefinedAnnotation</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">model_full_name</span> <span class="o">=</span> <span class="n">FullyQualifiedName</span><span class="o">.</span><span class="n">from_object</span><span class="p">(</span><span class="n">model</span><span class="p">)</span>
        <span class="n">forward_ref</span> <span class="o">=</span> <span class="n">e</span><span class="o">.</span><span class="n">name</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Failed to resolve forward reference &#39;</span><span class="si">{</span><span class="n">forward_ref</span><span class="si">}</span><span class="s2">&#39; in the type annotations for &quot;</span>
            <span class="sa">f</span><span class="s2">&quot;Pydantic model </span><span class="si">{</span><span class="n">model_full_name</span><span class="si">}</span><span class="s2">. &quot;</span>
            <span class="s2">&quot;You should use the model&#39;s model_rebuild() method to manually resolve it.&quot;</span>
        <span class="p">)</span>
        <span class="k">raise</span> <span class="n">UnresolvableForwardRefError</span><span class="p">(</span>
            <span class="n">msg</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">forward_ref</span><span class="p">,</span> <span class="n">model_full_name</span><span class="o">=</span><span class="n">model_full_name</span>
        <span class="p">)</span> <span class="kn">from</span><span class="w"> </span><span class="nn">e</span>
    <span class="k">return</span> <span class="p">[</span>
        <span class="n">FieldInfoWithDefault</span><span class="o">.</span><span class="n">from_raw_type</span><span class="p">(</span>
            <span class="n">model_full_name</span><span class="o">=</span><span class="n">FullyQualifiedName</span><span class="o">.</span><span class="n">from_object</span><span class="p">(</span><span class="n">model</span><span class="p">),</span>
            <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span>
            <span class="c1"># typing special forms currently get typed as object</span>
            <span class="c1"># https://github.com/python/mypy/issues/9773</span>
            <span class="n">raw_type</span><span class="o">=</span><span class="n">pydantic_field_info</span><span class="o">.</span><span class="n">annotation</span> <span class="ow">or</span> <span class="n">Any</span><span class="p">,</span>  <span class="c1"># type: ignore</span>
            <span class="n">raw_default_value</span><span class="o">=</span><span class="n">pydantic_field_info</span><span class="o">.</span><span class="n">default</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">pydantic_field_info</span> <span class="ow">in</span> <span class="n">model</span><span class="o">.</span><span class="n">model_fields</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
    <span class="p">]</span>


<span class="c1"># Register this plugin. Will override erdantic&#39;s built-in &#39;pydantic&#39; plugin.</span>
<span class="n">register_plugin</span><span class="p">(</span><span class="s2">&quot;pydantic&quot;</span><span class="p">,</span> <span class="n">is_pydantic_model</span><span class="p">,</span> <span class="n">get_fields_from_pydantic_model_with_default</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "..", "features": ["navigation.top", "navigation.sections"], "search": "../assets/javascripts/workers/search.d50fe291.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": {"provider": "mike"}}</script>
    
    
      <script src="../assets/javascripts/bundle.56ea9cef.min.js"></script>
      
    
  </body>
</html>